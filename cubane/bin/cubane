#!/usr/bin/env python
# coding=UTF-8
from __future__ import unicode_literals
from cubane import VERSION
import os
import sys
import argparse


def get_argument_parser():
    """
    Construct argument parser.
    """
    parser = argparse.ArgumentParser(description='Perform cubane utility tasks.')

    parser.add_argument(
        '--scan',
        nargs=1,
        metavar=('folder', ),
        help='Scan current or given folder for cubane-based websites.'
    )

    parser.add_argument(
        '--version',
        action='store_true',
        help='Show the installed version of cubane.'
    )

    return parser


def run_action(args):
    """
    Execute main script action according to given arguments.
    """
    if args.scan:
        _scan(args.scan[0])
    elif args.version:
        _version()


def _scan(folder):
    """
    Scan given folder for cubane-based websites.
    """
    from scan import scan_sites
    scan_sites(folder)


def _version():
    """
    Present the version of cubane.
    """
    print 'cubane version %s' % '.'.join([unicode(v) for v in VERSION])


#
# Main
#
if __name__ == "__main__":
    parser = get_argument_parser()
    args = parser.parse_args()

    if len(sys.argv) == 1:
        parser.print_help()
    else:
        run_action(args)
